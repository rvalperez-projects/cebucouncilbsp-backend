<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cebucouncilbsp.backend.repository.InstitutionRepository">

  <resultMap id="InstitutionResultMap" type="InstitutionEntity">
    <id column="INSTITUTION_ID" jdbcType="INTEGER" property="institutionId"/>
    <result column="INSTITUTION_NAME" jdbcType="VARCHAR" property="institutionName"/>
    <result column="ADDRESS" jdbcType="VARCHAR" property="address"/>
    <result column="CONTACT_NUMBER" jdbcType="VARCHAR" property="contactNumber"/>
    <result column="DISTRICT" jdbcType="VARCHAR" property="district"/>
    <result column="AREA" jdbcType="VARCHAR" property="area"/>
    <result column="CATEGORY_CODE" jdbcType="VARCHAR" property="categoryCode"/>
    <result column="CREATED_BY" jdbcType="VARCHAR" property="createdBy"/>
    <result column="CREATED_DATETIME" jdbcType="TIMESTAMP" property="createdDateTime"/>
    <result column="UPDATED_BY" jdbcType="VARCHAR" property="updatedBy"/>
    <result column="UPDATED_DATETIME" jdbcType="TIMESTAMP" property="updatedDateTime"/>
  </resultMap>
  <resultMap id="AreaDistrictResultMap" type="AreaDistrictsEntity">
    <result column="DISTRICT" jdbcType="VARCHAR" property="district"/>
    <result column="AREA" jdbcType="VARCHAR" property="area"/>
  </resultMap>

  <select id="findAllInstitutions" parameterType="map" resultMap="InstitutionResultMap" resultType="InstitutionEntity">
    SELECT
      MINST.INSTITUTION_ID,
      MINST.INSTITUTION_NAME,
      MINST.ADDRESS,
      MINST.CONTACT_NUMBER,
      MINST.DISTRICT,
      MINST.AREA,
      MINST.CATEGORY_CODE
    FROM
      M_INSTITUTION MINST
  </select>

  <select id="findAllDistinctDistricts" parameterType="map" resultMap="AreaDistrictResultMap" resultType="AreaDistrictsEntity">
    SELECT
      DISTINCT DISTRICT,
      AREA
    FROM
      M_INSTITUTION
    ORDER BY
      AREA ASC
  </select>

  <select id="findByInstitutionId" parameterType="map" resultMap="InstitutionResultMap" resultType="InstitutionEntity">
    SELECT
      MINST.INSTITUTION_ID,
      MINST.INSTITUTION_NAME,
      MINST.ADDRESS,
      MINST.CONTACT_NUMBER,
      MINST.DISTRICT,
      MINST.AREA,
      MINST.CATEGORY_CODE
    FROM
      M_INSTITUTION MINST
    WHERE
      MINST.INSTITUTION_ID = #{institutionId,jdbcType=INTEGER}
  </select>

  <select id="findByInstitutionNameAreaDistrict" parameterType="map" resultMap="InstitutionResultMap" resultType="InstitutionEntity">
    SELECT
      MINST.INSTITUTION_ID,
      MINST.INSTITUTION_NAME,
      MINST.ADDRESS,
      MINST.CONTACT_NUMBER,
      MINST.DISTRICT,
      MINST.AREA,
      MINST.CATEGORY_CODE
    FROM
      M_INSTITUTION MINST
    WHERE
      MINST.INSTITUTION_NAME = #{institutionName,jdbcType=VARCHAR}
      AND MINST.AREA = #{area,jdbcType=VARCHAR}
      AND MINST.DISTRICT = #{district,jdbcType=VARCHAR}
  </select>

  <select id="findByArea" parameterType="map" resultMap="InstitutionResultMap" resultType="InstitutionEntity">
    SELECT
      MINST.INSTITUTION_ID,
      MINST.INSTITUTION_NAME,
      MINST.ADDRESS,
      MINST.CONTACT_NUMBER,
      MINST.DISTRICT,
      MINST.AREA,
      MINST.CATEGORY_CODE
    FROM
      M_INSTITUTION MINST
    WHERE
      MINST.AREA = #{area,jdbcType=VARCHAR}
  </select>

  <select id="findByDistrict" parameterType="map" resultMap="InstitutionResultMap" resultType="InstitutionEntity">
    SELECT
      MINST.INSTITUTION_ID,
      MINST.INSTITUTION_NAME,
      MINST.ADDRESS,
      MINST.CONTACT_NUMBER,
      MINST.DISTRICT,
      MINST.AREA,
      MINST.CATEGORY_CODE
    FROM
      M_INSTITUTION MINST
    WHERE
      MINST.DISTRICT = #{district,jdbcType=VARCHAR}
  </select>

  <select id="insertInstitution" parameterType="InstitutionEntity" resultType="Integer">
    INSERT INTO
      M_INSTITUTION
    <trim prefix="(" suffix=")" suffixOverrides=",">
      INSTITUTION_NAME,
      ADDRESS,
      CONTACT_NUMBER,
      DISTRICT,
      AREA,
      CATEGORY_CODE,
      CREATED_BY,
      CREATED_DATETIME,
      UPDATED_BY,
      UPDATED_DATETIME
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      #{institutionName,jdbcType=VARCHAR},
      #{address,jdbcType=VARCHAR},
      #{contactNumber,jdbcType=VARCHAR},
      #{district,jdbcType=VARCHAR},
      #{area,jdbcType=VARCHAR},
      #{categoryCode,jdbcType=VARCHAR},
      #{createdBy,jdbcType=VARCHAR},
      #{createdDateTime,jdbcType=TIMESTAMP},
      #{updatedBy,jdbcType=VARCHAR},
      #{updatedDateTime,jdbcType=TIMESTAMP}
    </trim>
    RETURNING INSTITUTION_ID
  </select>

  <update id="updateInstitution" parameterType="InstitutionEntity">
    UPDATE
      M_INSTITUTION
    <set>
      INSTITUTION_NAME = #{institutionName,jdbcType=VARCHAR},
      ADDRESS = #{address,jdbcType=VARCHAR},
      CONTACT_NUMBER = #{contactNumber,jdbcType=VARCHAR},
      DISTRICT = #{district,jdbcType=VARCHAR},
      AREA = #{area,jdbcType=VARCHAR},
      CATEGORY_CODE = #{categoryCode,jdbcType=VARCHAR},
      UPDATED_BY = #{updatedBy,jdbcType=VARCHAR},
      UPDATED_DATETIME = #{updatedDateTime,jdbcType=TIMESTAMP}
    </set>
    WHERE
      INSTITUTION_ID = #{institutionId,jdbcType=INTEGER}
  </update>

</mapper>
